# Руководство по метрикам оценки моделей кредитного риска

## Введение

Этот документ содержит подробное описание всех метрик, используемых для валидации моделей кредитного риска.

---

## 1. AUC-ROC (Area Under the ROC Curve)

### Описание
AUC-ROC измеряет способность модели различать положительные и отрицательные классы. ROC-кривая строится как зависимость True Positive Rate (TPR) от False Positive Rate (FPR) при различных порогах классификации.

### Формула
```
TPR = TP / (TP + FN)  # Sensitivity, Recall
FPR = FP / (FP + TN)
AUC = ∫ TPR d(FPR)
```

### Интерпретация
- **AUC = 1.0**: Идеальная модель
- **AUC = 0.9 - 1.0**: Отличная модель
- **AUC = 0.8 - 0.9**: Хорошая модель
- **AUC = 0.7 - 0.8**: Приемлемая модель
- **AUC = 0.5 - 0.7**: Плохая модель
- **AUC = 0.5**: Модель не лучше случайного угадывания
- **AUC < 0.5**: Модель хуже случайного угадывания (инвертированные предсказания)

### Пороговые значения для кредитного риска
- **Минимум**: 0.7
- **Хорошо**: 0.75
- **Отлично**: 0.8+

### Преимущества
- Не зависит от порога классификации
- Легко интерпретируется
- Широко используется в индустрии

### Недостатки
- Не информативна при сильном дисбалансе классов
- Не учитывает стоимость ошибок

---

## 2. Gini Коэффициент

### Описание
Gini коэффициент - это нормализованная версия AUC, часто используемая в кредитном скоринге.

### Формула
```
Gini = 2 × AUC - 1
```

### Интерпретация
- **Gini = 1.0**: Идеальная модель
- **Gini = 0.6 - 1.0**: Отличная модель
- **Gini = 0.4 - 0.6**: Хорошая модель
- **Gini = 0.3 - 0.4**: Приемлемая модель
- **Gini = 0.0**: Модель не лучше случайного угадывания
- **Gini < 0.0**: Плохая модель

### Пороговые значения для кредитного риска
- **Минимум**: 0.4
- **Хорошо**: 0.5
- **Отлично**: 0.6+

### Связь с AUC
```
AUC = (Gini + 1) / 2
Gini = 2 × AUC - 1
```

---

## 3. KS Статистика (Kolmogorov-Smirnov)

### Описание
KS статистика измеряет максимальное расстояние между кумулятивными функциями распределения хороших и плохих клиентов.

### Формула
```
KS = max|F1(x) - F0(x)|
```
где F1(x) - CDF плохих клиентов, F0(x) - CDF хороших клиентов.

### Интерпретация
- **KS = 100%**: Идеальное разделение
- **KS > 40%**: Отличная модель
- **KS = 30-40%**: Хорошая модель
- **KS = 20-30%**: Приемлемая модель
- **KS < 20%**: Слабая модель

### Пороговые значения
- **Минимум**: 0.3 (30%)
- **Хорошо**: 0.4 (40%)
- **Отлично**: 0.5+ (50%+)

### Преимущества
- Интуитивно понятна
- Показывает точку наилучшего разделения

### Применение
Часто используется для определения оптимального порога отсечения (cutoff) в скоринговых моделях.

---

## 4. Precision (Точность)

### Описание
Precision показывает, какая доля объектов, предсказанных как положительные, действительно являются положительными.

### Формула
```
Precision = TP / (TP + FP)
```

### Интерпретация
- **Высокий Precision**: Мало ложных срабатываний (FP)
- **Низкий Precision**: Много ложных срабатываний

### Применение в кредитном риске
Precision важен, когда стоимость ложного одобрения (выдача кредита заемщику, который дефолтит) высока.

### Пример
Если Precision = 0.8, то 80% заемщиков, которых модель предсказала как дефолтников, действительно дефолтят.

---

## 5. Recall (Полнота, Чувствительность, TPR)

### Описание
Recall показывает, какую долю положительных объектов модель смогла найти.

### Формула
```
Recall = TP / (TP + FN)
Recall = Sensitivity = TPR
```

### Интерпретация
- **Высокий Recall**: Модель находит большинство дефолтников
- **Низкий Recall**: Модель пропускает много дефолтников (высокий FN)

### Применение в кредитном риске
Recall важен, когда стоимость пропуска дефолтника (FN) высока.

### Пример
Если Recall = 0.9, то модель находит 90% всех дефолтников.

---

## 6. F1-Score

### Описание
F1-Score - это гармоническое среднее Precision и Recall, балансирующее между ними.

### Формула
```
F1 = 2 × (Precision × Recall) / (Precision + Recall)
```

### Интерпретация
- **F1 = 1.0**: Идеальная модель
- **F1 > 0.8**: Хорошая модель
- **F1 = 0.5 - 0.8**: Приемлемая модель
- **F1 < 0.5**: Слабая модель

### Применение
Используется, когда нужен баланс между Precision и Recall.

---

## 7. Accuracy (Общая точность)

### Описание
Accuracy показывает долю правильных предсказаний от общего числа предсказаний.

### Формула
```
Accuracy = (TP + TN) / (TP + TN + FP + FN)
```

### Предостережение
❗ **Accuracy может быть обманчивой при дисбалансе классов!**

### Пример проблемы
Если дефолтников 5%, модель может достичь Accuracy = 95%, просто всегда предсказывая "хороший клиент".

### Применение
Используйте Accuracy только при сбалансированных классах. Для кредитного риска используйте AUC, Gini, KS.

---

## 8. Specificity (Специфичность, TNR)

### Описание
Specificity показывает долю правильно идентифицированных отрицательных объектов.

### Формула
```
Specificity = TN / (TN + FP)
Specificity = TNR (True Negative Rate)
```

### Интерпретация
- **Высокий Specificity**: Модель редко ошибочно одобряет хороших клиентов как плохих
- **Низкий Specificity**: Много ложных отклонений

### Применение в кредитном риске
Важен для минимизации упущенной выгоды от отказа хорошим клиентам.

---

## 9. Confusion Matrix (Матрица ошибок)

### Описание
Таблица, показывающая распределение предсказаний модели.

### Структура
```
                 Predicted
                 Neg    Pos
Actual  Neg      TN     FP
        Pos      FN     TP
```

### Термины
- **TP (True Positive)**: Правильно предсказанные дефолты
- **TN (True Negative)**: Правильно предсказанные хорошие клиенты
- **FP (False Positive)**: Ложное срабатывание (хороший предсказан как плохой)
- **FN (False Negative)**: Пропуск (плохой предсказан как хороший)

### Интерпретация в кредитном риске
- **FP (Type I Error)**: Отказ хорошему клиенту → упущенная прибыль
- **FN (Type II Error)**: Одобрение плохого клиента → убыток от дефолта

---

## 10. PSI (Population Stability Index)

### Описание
PSI измеряет изменение распределения переменной между двумя выборками (обучающей и валидационной).

### Формула
```
PSI = Σ (Actual% - Expected%) × ln(Actual% / Expected%)
```

### Интерпретация
- **PSI < 0.1**: Популяция стабильна, изменений нет
- **0.1 ≤ PSI < 0.25**: Умеренное изменение, требуется анализ
- **PSI ≥ 0.25**: Значительное изменение, модель может быть нестабильна

### Применение
- Мониторинг дрейфа данных
- Проверка стабильности модели во времени
- Выявление изменений в популяции

### Действия при высоком PSI
1. Проанализировать причины изменений
2. Рассмотреть рекалибровку модели
3. Возможно, переобучить модель на новых данных

---

## 11. CSI (Characteristic Stability Index)

### Описание
CSI - это PSI, примененный к скорам модели (predicted probabilities).

### Формула
Та же, что и PSI, но применяется к распределению скоров модели.

### Интерпретация
Та же, что и PSI.

### Применение
Мониторинг стабильности выходных значений модели.

---

## 12. Approval Rate

### Описание
Процент заявок, одобренных моделью при заданном пороге.

### Формула
```
Approval Rate = (Approved Applications) / (Total Applications)
```

### Применение
- Управление объемом выдач
- Балансировка между риском и объемом
- Определение оптимального cutoff

---

## 13. Bad Rate

### Описание
Процент дефолтов среди одобренных заявок.

### Формула
```
Bad Rate = (Defaults among Approved) / (Total Approved)
```

### Применение
- Оценка качества портфеля
- Расчет ожидаемых потерь
- Калибровка модели

---

## 14. Expected Loss

### Описание
Ожидаемые потери от дефолтов.

### Формула
```
Expected Loss = PD × EAD × LGD
```
где:
- PD = Probability of Default
- EAD = Exposure at Default
- LGD = Loss Given Default

### Применение
- Расчет резервов
- Ценообразование
- Управление рисками

---

## Сравнительная таблица метрик

| Метрика | Диапазон | Хорошо | Отлично | Устойчива к дисбалансу | Основное применение |
|---------|----------|--------|---------|------------------------|---------------------|
| AUC | 0-1 | 0.75 | 0.8+ | ✓ | Общая дискриминационная способность |
| Gini | -1